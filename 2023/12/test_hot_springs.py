from collections.abc import Iterable
from functools import cache

from pytest import mark


def part1(input_string: str) -> int:
    return sum(count_arrangements(damaged + ".", contiguous) for damaged, contiguous in _parse_input(input_string))


def part2(input_string: str) -> int:
    output = 0

    for damaged, contiguous in _parse_input(input_string):
        output += count_arrangements("?".join(damaged for _ in range(5)) + ".", contiguous * 5)

    return output


def _parse_input(input_string: str) -> Iterable[tuple[str, tuple[int, ...]]]:
    for line in input_string.splitlines():
        yield _parse_line(line)


def _parse_line(line: str) -> tuple[str, tuple[int, ...]]:
    bits = line.split()
    return bits[0], tuple(int(s) for s in bits[1].split(","))


@cache
def count_arrangements(
    damaged: str, contiguous: tuple[int, ...], damaged_i: int = 0, contiguous_i: int = 0, current_count: int = 0
) -> int:
    if damaged_i == len(damaged):
        return (
            1
            if contiguous_i == len(contiguous)
            or (contiguous_i == len(contiguous) - 1 and current_count == contiguous[contiguous_i])
            else 0
        )

    if contiguous_i == len(contiguous):
        if damaged[damaged_i] in (".", "?"):
            return count_arrangements(damaged, contiguous, damaged_i + 1, contiguous_i, current_count)

        return 0

    if damaged[damaged_i] == ".":
        return _count_combinations_operational(damaged, contiguous, damaged_i, contiguous_i, current_count)
    elif damaged[damaged_i] == "?":
        return _count_combinations_unknown(damaged, contiguous, damaged_i, contiguous_i, current_count)

    return _count_combinations_damaged(damaged, contiguous, damaged_i, contiguous_i, current_count)


def _count_combinations_damaged(
    damaged: str, contiguous: tuple[int, ...], damaged_i: int, contiguous_i: int, current_count: int
) -> int:
    if current_count == contiguous[contiguous_i]:
        return 0

    return count_arrangements(damaged, contiguous, damaged_i + 1, contiguous_i, current_count + 1)


def _count_combinations_operational(
    damaged: str, contiguous: tuple[int, ...], damaged_i: int, contiguous_i: int, current_count: int
) -> int:
    if current_count == 0:
        return count_arrangements(damaged, contiguous, damaged_i + 1, contiguous_i, current_count)
    elif current_count == contiguous[contiguous_i]:
        return count_arrangements(damaged, contiguous, damaged_i + 1, contiguous_i + 1, 0)

    return 0


def _count_combinations_unknown(
    damaged: str, contiguous: tuple[int, ...], damaged_i: int, contiguous_i: int, current_count: int
) -> int:
    if current_count == 0:
        return count_arrangements(damaged, contiguous, damaged_i + 1, contiguous_i, 0) + count_arrangements(
            damaged, contiguous, damaged_i + 1, contiguous_i, 1
        )
    elif current_count == contiguous[contiguous_i]:
        return count_arrangements(damaged, contiguous, damaged_i + 1, contiguous_i + 1, 0)

    return count_arrangements(damaged, contiguous, damaged_i + 1, contiguous_i, current_count + 1)


@mark.parametrize(
    ("damaged", "contiguous", "expected_output"),
    [
        ("", tuple(), 1),
        (".", tuple(), 1),
        ("#", tuple(), 0),
        ("#", (1,), 1),
        ("???.###", (1, 1, 3), 1),
        (".??..??...?##.", (1, 1, 3), 4),
        ("?#?#?#?#?#?#?#?", (1, 3, 1, 6), 1),
        ("????.#...#...", (4, 1, 1), 1),
        ("????.######..#####.", (1, 6, 5), 4),
        ("?###????????", (3, 2, 1), 10),
    ],
)
def test_count_arrangements(damaged: str, contiguous: tuple[int, ...], expected_output: int) -> None:
    assert count_arrangements(damaged, contiguous) == expected_output


EXAMPLE_INPUT = """???.### 1,1,3
.??..??...?##. 1,1,3
?#?#?#?#?#?#?#? 1,3,1,6
????.#...#... 4,1,1
????.######..#####. 1,6,5
?###???????? 3,2,1"""

PUZZLE_INPUT = """..???#??.?????? 4,3
##??#??#?..??? 9,1,1
.?##?#?????..? 5,1,1,1
???#?##??? 4,4
?.??#?????#???? 8,1
.?#?.???##??##? 3,6
??????#??? 3,2
?##??##???.??.?#? 3,4,1,2,2
#..#?#?.?????#.# 1,1,2,5,1
#???.###???? 1,2,3,2
???????#??????##. 1,3,2,1,2
?..??????? 1,1,2
.#????#??##?? 3,6
.???##???. 2,4
???.##??.#????#?.? 3,2,1,2,1,2
.???????##??.???? 8,3
#??????#????.?.. 1,1,5,1
??????#??#?.?# 2,2,2,1
.....??#??.?.???? 2,1
?????.#?#?#??..?? 1,1,4,1
.#?.?????? 2,2
???#??.??????? 1,3,4
?#??????#???..??.?#? 10,1,1
???????.??. 2,2
?????##??#?? 1,6
?????#?##?????#? 1,1,6,1,2
???#??????.? 5,1,1,1
??#.?##?.#??#??.?.## 2,2,5,2
??#?#??#?#.?.??.?.# 7,1,1,1,1,1
.#??##????#??????#? 12,5
?##???#?#??????. 4,6
.?.??????????#????#? 1,1,2,7,2
.?????????#.???????? 1,3,2,8
??#?.?.?????? 3,1,2
.????##????.??????? 7,2,1
????#??.?????????? 2,4,2,1
???.????#?#???. 2,1,1,2,1
.#???.???##?????##?# 4,14
??.?.?#??## 1,1,6
#.#??#?????##??##?? 1,1,1,1,9
.#.##????.#?#??#?. 1,5,1,4
.???????## 1,2,2
?.????.??.?. 3,1
????.#?#?#.?#? 2,1,5,1
????####??##??????? 2,14
???????#??? 2,7
#??.#?#?##??. 2,1,6
???#?#???????#???? 2,9,3
##???#???#????..# 3,3,1,1,1
.?.????.?..??#???# 2,1,1,1,1,2
?????.?????#??. 2,1,1,2,1
?????.???? 3,1
?????###?????..?? 1,8,1,1
.?.??????#?.? 1,1,4,1
?#?.??????#??# 2,6,1
?.??..??#?..??#????? 3,2
???#??????? 1,4,2
#?.?#????#?? 1,4,2,1
?.#?????.??#. 3,1,1
#?..?#???##??#?????? 2,13
????????.. 1,1,1
?###??#????#?.#??# 6,3,1,1
???.??#????##?#?#?? 2,2,7
????????????.??# 1,4,1,3
????##?..#. 2,3,1
?.?#.?.??.#.#??? 2,1,1,3
??#??#???.#??##?? 1,1,1,6
???#?##?##?.??#??#. 2,1,6,5
????#???#??.??#?. 1,5,1,1,2
??.?..???????.?? 1,7
?#???#?.????#? 4,1,1,2
.?##???.????.? 4,2
.#????.?????#??? 1,2,6,2
?.???#???#.?#? 3,1,1,2
???.????#? 1,3
#.#??#??.?#.# 1,6,1,1
.#??.????#?# 2,1,3
??.?.##??#?#?????#? 2,1,5,2,1,2
.?????.#??? 2,3
???.?.??????????? 2,1,3,2
????????????????? 2,2,6
##.?#?#????.# 2,6,1
??.?????????#?? 1,4
?????????.??????? 5,1,1,1,1
?#?????##?#????###. 2,2,4,5
???.???????????? 1,1,1,4,4
????..?.?????..#??.. 1,2,1
?#?#????.??.????? 4,2,2,1,3
.#??.?#.?#.#???#?.? 3,2,1,3,2,1
.????#?#????#.#?.. 10,1
#.??#??#?? 1,2,2
?.?.??#??? 1,3
??????#.??.? 6,1
???.#.?????#?###? 2,1,9
???##????# 6,2
?#.????##?.??.????? 2,7,1,4
?????.?#??.? 1,1,1,1
?#???...?? 4,2
?????.???#?? 2,1,1,3
?#??.?.?.#?????. 4,1,2,3
?#..?.?????#.? 1,1,2,2
?????###????#? 1,6,1
?.?#???#?#???.???. 1,3,6,1,1
.????#?##????#?#.?? 1,3,3,5,1
#???#.???# 2,1,2
.?#???#???????.#??# 1,1,2,3,1,4
.??.??.?##???#?##. 1,1,9
?####.???? 4,4
?#??##????#.?#? 9,1,1
?#?..?#.##?#.?.?#? 1,1,2,1,1,2
????????.#?. 1,4,1
????#???#??#.?#.? 1,2,1,4,1
?#?###????##?#??.# 15,1
?#?#?.#???? 3,4
..##???##??? 2,5
???..??##.???#???? 3,2,1,1,1
#.??????..???????? 1,2,2,2,1
?????#????? 2,3,1
.????..##????#? 1,1,7
?.??????.??? 4,1
????#?????...??..?. 1,1
?.?.?##???#????.?#? 10,2
??#???.??##?#??.??. 3,4,2,2
?####?###?#??#.????? 11,1,1,1
??..?????? 1,1,1
?#???#?#?.??#? 2,4,2
..????#?.??. 2,2,1
?.?#??.??#????##?? 2,9
???..????. 1,1,1
??.??#.#.??.???#??? 1,1,1,1,1,7
???????????#??? 2,1,6
.?#??????? 2,1,1
?#.??????#???????#? 1,10,1,1
??#?????.?.???? 5,4
#?.#???#??.??.## 1,1,2,1,2
??????#??#??.# 1,2,6,1
.?#?.?????????#???? 3,4,1,1,1
..?.???#???.?? 1,1,1,1
?#?#????#.??.?? 2,6,1
??#??#??#? 2,5
..??#??##?#?.? 3,4
.???###?.#??#????. 4,6
.??.#.?.#??? 1,1,1,1
?#??##?##???#???.?## 2,12,3
.#?????.???..?? 1,1,1,1,2
?#?##???#?????#? 4,3,1,3
?????.?####??.? 3,5,1
????.??#?#?# 3,1,5
???.##??#??# 1,8
??.?#?##????#?.?# 1,1,4,2,1
.?#????..?#? 4,2
.#.????????? 1,2,2
??#????.??#.??????? 4,3,7
????#?#??.????#?? 5,5
?#.???#???#..?##?# 2,6,1,5
.?#?????????.??##??? 1,4,3,6
.???#??#??# 1,5,1
????.????###???#?#? 1,1,1,5,2,1
???????#?#??##?. 1,1,10
????#?..?????.? 4,1
???.???#?#????#?.#?# 1,1,8,1,1,1
??###???#.?. 3,1,1
????#??.?#??##?#?# 1,1,1,10
###??#???.?#???### 4,1,1,8
#?.?????#??#?#?#? 1,13
#.???.?.??#??#? 1,2,1,1,5
?????#.???#??#?#... 5,3,4
?#?#??#???.???#???? 4,3,1
#???#??##??###?.?.# 5,8,1
??????.????#???#?#.? 3,5,1,1,1
??##?.?#?#. 4,1,1
#??#.?????###? 4,1,5
#?#???.?#??# 3,1,3,1
?#?#?.?#????? 1,2,1,3
.?????.##???#?.???? 4,7,1
#?.?#?????????##?# 1,4,1,5,1
?????#??#???.??# 5,3,1,1,1
#?????????#??????.?# 1,1,1,7,1,1
.???##???.???#??. 7,3
#???#?????.??? 1,3,2,2
????.??????? 1,2,2,2
?.??????.??. 1,3,1
???#?#????.??#? 6,3
??????##?#?#?#????#? 1,1,1,6,6
?#??#???#???##??. 1,2,8
?????#??#? 1,1,4
.???.#??#? 1,2,2
???????????? 2,2,1
?#???.???????? 3,1,6
??.#..#?.?#?? 1,1,2,2
?.????#?#? 1,6
??.#?????#??###??? 1,1,1,9,1
?#??#??.???????#. 7,3
??#??.??.?. 5,1
?????##??????#? 2,3,1,3
?#????#?.?.#..? 7,1,1
.#????.?.?????? 4,1
#???#?????????.??# 9,1,1,1,1
.???###?.????#??#??? 4,7
?????.??????#.???? 1,6,1
.??????#??????.???# 1,2,3,1,1,1
?#?????.????.?????? 1,2,1,1,3,1
???..????? 3,1,1
.?#??.?..??##? 3,4
???...#?#???.? 2,5
??.???##?#.? 1,6
??#.?????##?#?#?#? 1,1,1,1,6,2
??#???..?#. 2,1
#.??????#?.?# 1,1,6,1
.?#?##?????#???? 8,5
?.?.????#??? 1,1,5
???###???????????# 8,3,1,1
?#?.????????.#.? 3,1,1,1,1
??..????????. 1,1
.???#?..#?#??. 5,3
.?.?.????. 1,1,1
????????#...# 1,4,1
?#????#.?##??. 1,1,1,5
.?.??.??.?#?..? 1,1,1,3,1
?#?#?.??.?????? 4,1,1,1
??##???????? 5,2
???#??#???.???.#? 6,2
##?##?#??.#? 2,4,1,1
.????.??#?????.??. 3,6,1
?????#?.??##? 3,1,5
.#????#?#???#?# 1,2,3,5
??.????.?.???? 2,2,1,1
.????.?.?? 3,2
.?.?#????.????# 3,2,1,1
??###.?.?? 4,1,2
.???.?????.??? 1,4,2
???.??#??????? 1,4,1,1
?#.#..?##?????? 1,1,7,1
?#???##??????? 1,8
?..??#.????? 1,3,5
??#??#..#???? 4,3
#?#??.?#???.#. 5,3,1,1
#???#?.#????.????. 1,1,2,1,3,1
.?????????. 3,4
???#??????????.#??? 1,9,1,2,1
?.#?...?.?????.??#? 1,2,1,3,1,1
.???#?.????#?? 3,5
????.??.??.# 1,1,1,1
???????#?#????#???. 10,3,1
#????#??##???#?.?? 1,1,1,4,1,1
???????????.#????? 7,2,1,1
?###?#.?.???##?? 5,5
?##?#????#?? 7,2
??#??????#??#?#?# 7,2,1,1,1
??????#?.????? 3,1,2
?#????.?##??..#?# 5,5,1,1
#?###?????????.##.? 9,1,1,2
????????#?#?.?? 5,4,2
??????##?.#. 2,1,4,1
..?#.?#????.#? 2,6,1
?##?#???#??#??#??#?? 8,5,2
?#.?#??????.????? 2,6,1,1,1
?.??????#???.#. 7,2,1
??#?##?#..???? 6,1
????#??..#? 5,1,1
##??.?.??.?? 4,1,1,1
?#?.??????#?# 1,9
.????##????..#??? 8,1,1,1
??????????#??#?#??? 4,9
.###?#.?????# 5,1,4
#.?????..?? 1,2
?.???#?????? 1,1,5
?##??##????? 2,2,1
.??????#?#?#??? 1,8,1
??#..?#???##?.#?# 3,3,3,3
?#?#????.##?????#.? 3,1,5,1,1
.???#?.?.??#?.#???? 2,3,3
??????????.? 1,1,1,1
##?#?###?????????.# 10,1,2,1
.#.??##?#????#?. 1,7,2
.?????????????#?.? 1,2,6
????.#.???????? 2,1,2,3
???.?????.?. 2,1,1,1
?#??????#?.???.?? 1,7,1,1
????????????? 1,4,1
..?##?.?.????? 4,4
????.#???? 1,1,1
??#????#??.??.???? 1,6,1,2,1,1
??#???#??.??? 1,1,2,3
?.?????#??#???#?? 1,9
#?.##?#??#??.?.??#.? 1,2,6,1,1,1
...???????#?#?.??? 1,4
?????#????.?#?.?? 6,2
???????????? 1,6,1
??..?.????##. 1,5
#???##???#??.?. 6,2,1,1
..??#.?#??#???????? 3,3,1,1,1,2
?????????? 1,1,1
???..??#?..? 2,4,1
?.??#???#?##?##?#. 1,14
#??????.?. 1,3
###?.?.???.???.# 3,1,3,1,1
??#???????#.?? 6,2
.??????#??#???? 5,6
???#.????.# 2,2,1
?#?##...??####??.??# 4,6,3
..?#?#?..#.???? 5,1
???#?#??????? 1,4,3
?????#???#??#???#? 1,1,3,1,3,2
..??#?.????#???? 3,5
###..#.???#??#???# 3,1,1,6,1
##?????####.???? 3,7,3
?#???##.????#?#???? 2,4,2,2,1,2
.?.#?..#??.#? 1,1,3,1
??.?##?#?????.??.??# 1,7,1,1,2
?#??.#????#???#?.? 3,3,7
????.?.??? 2,1,1
.???.??.#??# 3,4
?.???#????????# 5,1,1
.??..?????. 1,2
???.#.?.#?.?.??#?.. 1,2,2
????###???.?#???. 6,2
???##?#.??? 6,1
???????.?#??.??#?? 1,4,4,4
????..?##?##.??? 6,1
#???????#?#? 1,1,6
??#????#????? 7,2
.?#??#???? 5,1
.??????#?? 1,1,2
.??#..?#?. 3,2
?#??#?#??????## 2,4,5
..???#???????? 2,2,1,1
.#??##???#??#??? 1,9,1
.???.?#??????. 1,1,3
??#?????????????##?? 2,5,3,4
??#???#????????.???# 1,6,1,4,1,1
?????#?#?.???. 6,2
.?????#?##??.????#? 10,6
.???#??#??#?.#?. 10,1
?#?.?##????? 1,4,2
???..??#??#?.. 3,3,2
?#????.???????#. 6,1,1,1,1
?..?#####.??#? 6,3
.#.?#???#???????.??? 1,9,1,2
??#.?.????.? 3,1,1,1
??.?#??????????#?? 4,5
??.#??.????? 1,1,2,1
?.#??##?###.???. 1,1,7,1,1
#?#..#?..##?. 1,1,2,2
???????.??#??.?.? 2,1,3,1,1
.??#???#.??#??? 3,2,5
??????.#.???#????? 2,1,8
.????##?#?.##????? 8,4,1
.???#?.#?#.?? 4,1,1,1
???????#??.???.??#.. 4,2,1,1,1,1
#?#?#???.??.?#???#?? 1,1,1,1,1,8
.????..??. 4,1
???#?#???#?#..? 1,5,1,1
?.#??#????##?#??.??? 5,2,1,1,1
??.?.??.??.?????# 1,1,1,5
..??.???.??.?. 1,2
.?????????#? 1,1,3
.?????##???.?..?#??? 9,2
??#??#??##?.?? 4,3,2
???.?..????.? 2,1,3,1
#..???#?#.??#.??? 1,1,3,2,1
.??###?.??????#??# 5,4,1,1
???#?#???.???????. 1,2,1,2,3,3
.??#?##??????..#?#. 3,4,1,1,1,1
...?#??.?.#??????##? 2,1,10
????##?.#?#? 1,3,1,1
???????????? 1,2,5
.?#??#???.?.??#??#?. 5,1,1,1,3
?#??##????. 6,2
.?#?.??#??.????#?? 2,5,7
??#??????#. 4,3
.????.?.?????###???? 3,1,12
##??#?#?#????#??.??? 5,4,2,1,1
?#.#????.??.?#..??#? 1,5,2,1,4
?.?#??#?.# 1,4,1
.?#.???.#. 1,1,1
#?##.????#?? 1,2,1,3
.??#?#?.?????? 5,5
..?????????????.???. 12,1
??#?????????#?? 3,5,1
.??????###?#?? 1,9
#...?##??#? 1,7
???..????.?. 3,2,1
?.?#?.???????.#? 2,4,1
?####?#?.??.??.#?? 6,3
.??##??.??.#### 5,1,4
.#?????.#???#? 3,1,4
?#?##.?.??. 4,1
???##?##?.?.???.?. 4,2,1,2,1
?????#?#?.? 2,5,1
#?#??.#??#?#???.?? 1,1,1,4,1,1
???????.?? 1,1,1
????#..??.?# 2,1,1,1
????????.???# 1,3,1,2
?#????#???#?#??? 6,3,1
??###???????????? 3,2,3,2
???????.???#??? 1,2,1,2,3
??.?????.???.?? 3,1,3,1
?###?.??????? 4,1,1
??#??????? 3,1
#..??#..??.???#?? 1,3,2,1,3
?.??.#??#??##?????.# 1,2,1,3,3,1
#.#?.?#??.?????# 1,1,4,1,3
..?#??.??#?.?##???. 4,1,5
#?##???.?#????..?. 6,6,1
.#????#?#??? 1,2,1
.#??#.#?????#?#??? 4,10,1
##??.???.#?#?#? 4,1,1,1,1
?.???.????#? 1,2,2,2
??#??.??.? 4,1
??#?????????.??.??. 4,1,1,1,2,1
????#?.??? 2,2,2
.??#.#?#?????????# 2,5,1,3
##?????????? 2,1,3
?.?????????#??#??. 2,1,7
??????.??? 5,1
???????#?..#?#?? 2,1,2,3
.??#..?#??.??? 1,1,4
?##.??#???#????#??? 2,1,1,4,3,1
??#?????#????? 4,3,1
#?##?#???#???? 4,1,2,2
???.????????.? 1,6,1
?..##?#.??.??? 1,4,1,1
.?.##??#??#?????? 8,3
?.?.??#??. 1,1,3
#.???##?#???#???#??? 1,14
???#??..???. 1,4,2
?##???.?.. 5,1
?#?...??#?. 2,1,2
?#?.?#??#???????? 2,6,6
?###..????????.?? 4,2,1,1,1
?.#.?...#.?.? 1,1
??##????.????##? 4,1,1,1,3
?.#??.?##?.?? 2,4
#####?????#.???? 6,2,2
??#.?.??#????#???? 3,11
?#.#?##?#???? 1,7,1
?????????###?###.? 5,8
?##?.?.?#???? 3,2,1
#.####???#??#?..? 1,12
?.?#?????#?.#. 8,1
???.??#.??????#? 3,2,4,2
???##??#....??. 2,5,1
??#??.?#?.?????? 3,2,4
????#.??#??#?## 1,1,1,5
???????.#? 4,1,1
?#?..???.??? 1,1,1,1
?#????.??? 1,2
??#???#??? 5,3
?#??.????#?? 1,1,4
????#?#.??#?.. 4,4
????#???.??.?.? 5,1
??????.#??????.# 1,3,7,1
?###????????#?#???.. 9,5
???#??????.? 6,1,1
?#??????????###???. 9,5
??????.#????# 1,1,4,1
??..#??#.?? 1,4,1
???????????##?#?.?? 1,2,1,3,5,1
?#??..?#???.## 1,1,4,2
?##?#?..## 5,2
.?#?.???.#. 1,1,1
.#?.????????..#? 1,1,1,2,1
?#??.?????##?#?.?.# 2,1,7,1
???##?.???..?.?? 5,1,1,1,1
?#?#????.???##????? 7,8
##??#?#..#???.??? 7,1,2
??.??.????? 1,4
??.#.???.?.???. 1,1,1,1,3
..?#???#?.. 2,3
#.##????????.?? 1,2,4,1,2
???#.????? 3,3
.????#??#?#?##??# 12,1
.?#####?#?#????#. 12,1
....#?#?????????# 9,2
??????##?#?? 1,4,3
?.??#??????##??#?#?. 4,9
#????.???? 1,1,1
#?#???.?.????? 1,1,2,3
..???????#???####. 1,11
??????##???. 1,1,7
????????????#?????? 1,1,14
.?#???#?????# 2,1,5
??.???????..?? 1,1,2,1
???????.?? 2,2
.?.#?#?.?## 3,2
#??????.#. 4,2,1
?#????????#.??. 1,2,1,1,1
##?.?.#??##??#?? 2,1,9
?????####??#???? 1,6,1,1
.#.#????#?#.??? 1,1,5,1,1
??.?????.? 1,4
.?.?.??..? 1,1,1
?.??????.????? 1,1,1,3
.#????????? 2,5
??.?.?.#?? 1,1,2
??.?#.???.???#?#?#? 1,2,1,6,1
.???#.?.???#? 4,1,2
.#???????##??##?? 1,1,10
.????????#????.#?? 10,2
?#?#?.#??????. 4,1,2,2
?.##?..?#?#? 3,1,1
.?..???#..??..?.? 3,1
?????#?.?? 2,2,1
????##????.?.???#.. 5,3
.??.??#.#?? 2,2,1
??#??#??#?##?? 2,10
.??#..???#????????? 2,11
.??????.??##???????? 5,10
????.????#? 2,2,1
?#.??.??.?#. 1,1,1,2
??????#?#????#??? 2,13
?#.?.#?#??#??# 1,1,9
?..??..??????#? 1,5
?#??????#??#?. 1,1,6
.???#?#???? 1,5,1
..##?#?#??? 2,6
???????.???.??? 3,1,2
#????##???.???? 7,2
?#???????.?? 9,1
???????????.#???#??? 5,1,1,1,1,4
?.?##?##????.??? 1,10,1
???#??#??????#?. 7,2
??????.?.#? 4,1
????..????????? 2,3,2
.???.#?##???? 1,4
??????.?#???#?. 1,1,2,3
??.???????# 1,6,1
??#????????##? 4,6
.??#??.??#? 2,3
?????.?.?..??? 3,1,1,1
..?.?#?##.?#????#?# 5,8
?#????..?????. 6,2
?#?.??????#??. 1,7,1
#??##.?#?#??#???.? 5,1,4,1,1
.???.?????.? 1,2,2
.?????.#?????????? 3,3,1,3
#.????#?##???? 1,1,1,6
..?#?#.??#.?.?.? 4,1,1,1,1
.??#???????.??? 3,4,1,2
??###...##??? 3,3
?.?#????#????? 1,2,4,1
..??.?#???.?#?#?. 1,3,4
????.??#??.???##??? 1,1,1,6,1
???#?????? 1,1,1
?#???#??.?????#?.?? 6,6,1
??????????????.##? 9,2
.#????#.#??#?????? 1,2,1,1,4,1
?.?#.??.??#???? 1,1,1,3,1
.??#?#??#.??????.#? 5,1,1,2,2
???#??#.#????. 4,1,1
??....??????....? 5,1
?#????#????#?? 3,2,1,2
.#???????.?.?? 1,3,1,2
##????#?#.##?# 4,3,4
??..#??????#??? 1,1
.#?.????##? 1,2
???????????#?#? 2,3,4
??.#??###?#.???.#.. 1,1,6,1,1
???#??#??#???#???. 1,1,3,8
.???##..?.#??## 4,5
.##???##?..#??? 7,1
????.???????#? 2,1,3,1
?#?.##??#???? 2,6
????#???#??#?????? 2,2,11
?#?????#??#??? 1,3,5
#????.?##???#?#??? 3,1,3,2,1,1
#?????.?#????.???#?? 5,3,1,1,1,1
????#?.?.##??# 2,1,3,1
????#.???#??????##?# 2,2,1,1,2,4
..????##???#?????#?# 4,10
#???#?????.????#..? 5,5
??????#?????????? 1,5,1,1,4
.?#?????##?.#?? 6,2,3
.?#.????#?#????????. 1,8,4
?????#???#. 1,2,1
.?#?#????#. 2,6
?????#...???? 2,1,3
?????.??????. 2,2,5
??#?.????#????.?#?# 4,4,3,1,1
.?#??#???#??????.?? 4,6,1
.##?#.#???.??? 4,3,1,1
?#??.?#??#?## 2,3,1,2
#.??#??????#??#? 1,13
.???.????#???#?#? 2,5,5
###..??#.???.???.# 3,1,1,1,1,1
??#.???##??#?##?#?. 3,2,8
???????#???#? 9,1
??????#?????#? 1,2,2,4
?.####?.?# 5,1
?.???????###??.?..?# 1,10,1,1
#?#?#?#????. 3,7
.?#???????? 2,1,1
.????##..?# 6,1
???.??.???.#?? 1,2,2
#??#?#??..???.? 2,1,3,3
###????#?.?.?????. 8,4
??#??...?. 4,1
?.?##?????#?#??#? 1,4,1,4,1
.?.??????.?##??#?? 1,1,4,2
?.#???.??##?#??#??# 1,1,1,1,10
.?#??#?.?.??? 1,1,1,2
??????#...?#?#?? 3,1,5
?.????#?.#?###. 5,5
?????#???.?? 1,2,4,1
??.????#?????# 2,5,2
?#????#?#?????. 1,9
?#??..##?# 3,4
?..???????#??.?.?# 1,10,2
?#.??#?????##.?.??. 2,5,2,1,1
#????#?????.?#? 1,1,4,1,1
??.##??.?????????? 1,3,3,4
?#??????.????##????? 6,1,1,4,1,1
????##?#??? 7,1
#???#?##???#?#???.#? 2,2,6,2,1,1
?.#????????.? 1,3,1
??????.?.???#???#? 1,9
???#.#???###?????? 1,2,1,6,2
#????#??###?#??..# 1,9,1
?#?????#?.?..?.??#? 2,1,1,1,1,3
?#.????.?#.##?#? 1,1,1,1,5
??#??#???????.? 11,1
??#?###?.?#. 5,1
??#.?????.??? 2,5,1,1
???.???.????#?##? 3,1,1,1,6
????.??????.?.#???? 2,2,2,1,2,1
???##??#?#??.??##?.. 5,3,5
??#????.?#? 1,1,2
?.?.????????#???. 4,4
.?????....?#????#?.? 2,7
?.?#??##???.#.???#.? 5,1,1,1,1,1
????#?.##??????? 1,2,6,1
??#??????#?#???#? 10,2
..?#?#????###?.?.? 10,1
????????.?.??.?.? 3,2
#????????.?????? 3,1,2,2
?????###????? 1,9
.?#???.?#? 3,2
.#????#.?##?#??? 1,2,2,1,1
?????????#?. 5,4
..??...?#######.. 1,8
.???#??.????#.#?.??? 4,5,1,1
??...?#??.????#?#. 2,2,2,3
.?##.?#????.? 3,5
#???##?..??.?.#.?? 3,3,1,1,1,1
???????????? 3,1,1,2
?????#?##..???????? 1,7,3,1,1
???.??????#?# 2,4,1,1
????#??.#????##??.? 2,2,8,1
???#????#??#..?# 8,1,1
????#?.?#.# 5,2,1
.#.??#..?#? 1,2,1
?..?.#?..???##? 2,4
.????????# 1,7
.??#?????.????? 7,2
?.????#??????. 1,9
?#.#?#?.?? 1,1,2
??.#???#.?????..?.# 1,2,2,2,1,1
??#.?.?#.? 1,2
.##???#.#?##??.???# 2,1,5,4
?????????#?? 1,4,1
?????..??.#??????? 2,1,1,3,1,1
.?#??.#.#??? 2,1,1,2
..?.?##?????#.?#? 1,5,1,2
???#.?.##???#??? 3,1,3,1,1
???#????..#????????# 5,1,1,1,4,1
???.??????#???#??# 1,1,1,9,1
??#???.?.?#?.??? 4,1,2,1
.???????###?#??#?.## 5,6,1,2
?#??????????? 3,1,1
?.????#???. 1,2,4
?????#???#??... 1,2,5
????#?#??#??? 1,5,1,1
?.?????#.#.? 1,1,1,1
#?.??????##? 1,1,1,3
??#???????##????.#?? 1,4,5,3
?#?#??##??.?#?# 4,2,1,1,1
.##???????????#???? 4,2,4,1
??#??.?????? 2,5
??#???????.#? 6,1,1
?.#?????#??#.? 7,2
???????????#??? 1,3,4
..?#???#???##??. 8,4
??#?.#??#??????#??#. 1,14
#??##..#.. 5,1
???#?#????.?#..? 7,1,2
#??#????.?#.???????? 2,1,1,2,6,1
??##??..???#.? 5,1,1
???????????#??.????? 1,1,1,7,1,1
??#?#??.?#?? 1,5,2
???.?.#.??.?#.#???# 1,1,2,1,5
?.???#??????.?.?.?. 6,1
??.???.??#?# 1,3,4
?????..?.? 4,1
#??##??.????????? 6,3,1,2
?????.???#?#?????? 1,6
????##?#?# 4,3
..??#?????#. 3,3
??????.??? 1,1,1
????.#?#???.?#????? 3,2
?#??#.?###?#?? 2,1,8
?.??#???#?#?#?.#. 1,10,1
?#??#??.?##?? 5,4
??#?##?#?#?#??##??#? 6,3,5
?.?.?.##?.??. 1,1,2,1
?.?#??.#.? 4,1,1
?.?#?#???. 1,1,4
?#???????? 2,2,1
????#?#?????#. 5,2,1
????##??#?.??? 1,7,1
????#?????##??????? 1,2,9,1
???###?#.??. 1,3,1,1
??????#????????? 9,3
?.????#.?.????#? 1,1,1,1,3
.?.??#??????##?. 7,2
??#??#..?? 3,1
..?#??#??????.??.??? 9,1,1,1
????##??????###?#.?? 1,5,5,1
.????#??#?? 1,2,4
.##???????..???? 2,2
##?#?.?#??#??#??? 4,4,2,1
?#??#??.?# 5,2
.????#.???? 4,1
??????.??#?.. 4,3
.??##?#?.????????? 5,7
.?.???.??##?#??## 1,2,6,2
.?###???????????.? 5,5,1
?.#?#.??????? 1,1,4
##??????#?? 5,2
?.????????? 1,4,2
##?###?????????.? 9,1,2
??##??.##??. 3,1,2,1
.#??#??#?? 4,1
##??.?.???#?. 4,1,3
???.??#?###..?.??? 1,7,1,1
.?????.?#.? 1,1,2
??..???????#..##?? 2,1,3,4
.?#.?#?#?? 1,4
?#?#???####????.???? 2,1,9,1,1
?????#????.????#?? 3,1,3,4
.?#??.?###???## 3,3,2
??.??????.. 2,2
??????.?.??.##???# 1,1,1,1,4,1
?????##?.??.? 1,3,2
.??.??.??#??.??#??? 2,2,1,1,2,1
#??????#???###???? 1,1,1,7,1,1
?#???.?#.?#??. 1,2,1,3
?.?#..???????.? 2,7
?#.#?#?#???? 1,3,1,1
.#?????.??...#. 1,2,1,1,1
???????????#?#??. 1,7,2
??#???#???.???## 1,1,1,2,5
?.??#..?#???#?????? 3,9
???##??.#?#????####. 1,2,11
.?##??.##?#?#?? 3,6
????.??##?? 2,4
??.?##?.???.?#? 1,3,1,2
???#?.?.#?.? 4,1
#????????# 1,3,3
???#?#?#??#?.??? 4,1,2,1,2
..?##??#?#.?????#??. 7,1,1,2
???.????????. 1,1,2,2
.?##?##?????. 2,2,2
.?#???????????.##??? 1,2,2,2,2
#??????.??#????# 6,4,2
??.????#?#? 1,2,4
??????.?????????? 4,2,1
??????#??? 3,3,1
.###????.?? 6,1
??.???????. 2,1
?##.#?????.? 2,1,1,1
?.????#?.??#??????? 6,4,1
.????.???##?? 1,5
#?#???##??#??? 9,1
???????????.?.??? 1,8
???.#..???#????. 3,1,8
?.?????#??????? 1,1,7
?#??????#?#?????? 2,7,1
?#?##?#??????# 1,6,1,1
??#???#??#...????? 9,3
#.??#??#?.#???? 1,2,1,1,1
?##?.????? 2,3
?#????##?.??###?? 8,3,1
.????????.?.??.? 7,2
.???#???#???.#?.? 6,1,1,1
?##??????#??? 3,4,2
???##?????#.??#???#. 3,1,1,5
??.??????##?????.? 1,1,1,6,1,1
?#??????#?#. 4,4
????????#?????????#? 1,2,3,1,5
????#????#???#??#?? 7,5
?????#????. 3,6
#?#??##?.?###????#. 3,2,4,2
???.#???#?## 2,1,2,2
??.?????????? 1,1,8
?.?????#?????? 6,2
#??.?#????#??.? 1,1,2,2,1
???###?#??#?????? 8,4
#??#.?.#???? 1,1,1,2
????#?#???#?.?.?.? 8,1
??????.?###?###??. 4,3,5
??##???#???#? 3,1,2,2
??.#.???#??# 1,1,4,2
#????#?????#?????#? 1,1,1,12
.??????#?#?? 1,6
??#????#????#? 2,3,2
?#?????#???...#???? 10,4
??.?????#????#?.? 1,4,1,2
???.????#?##?. 1,9
????????????????. 1,5,1,3
??#.?#?????.? 1,1,2,1
????#????#?????? 1,2,1,3,1
??#??..#??.?? 1,2,1,1
.???.??#?..??. 1,4,2
??.???#????#????#??? 2,4,1,2,4,1
???.??????.??#? 1,2,2,4
???#??.??#???# 1,1,1,2
?????#.????????.#? 2,1,1,2,1,1
#???#?#?#?#?????? 2,9,1
?#?#?#??.#????? 1,5,3,1
???.#????.##?##???? 2,4,7
.?..#??#?? 1,2
??.??????#??.??? 1,1,3,1,1
?.???????? 1,2,1
??#????????#??????.# 1,1,1,11,1
?#?.???????##.?#??. 2,8,4
.?#???.?#???????#?. 3,2,1,1,3
??##.#?.?#??#.# 3,2,1,2,1
##????.?#. 4,1,1
???#?#?..?####??? 5,4
##?.?#??#?????##??.# 2,8,4,1
.#.?.??.????### 1,1,1,6
?.??#??????#?? 1,1,3,4
??.??.???.?#?? 1,1,1,2
.#???#??????##. 1,1,4,4
??.?????#?#???????? 1,12
#????##????#??#???? 1,14
???????.#.??? 5,1,1,1
????.?#?????#?#.# 1,1,2,7,1
?.#?.#?##????# 1,2,6,1
.????.??#?..?#?? 1,2,4
?#??###???.? 1,6
?????..?#??#??? 4,6,1
#???#????.#? 1,2,1,1
?#?????##???#? 2,9
?#?.#..?##? 2,1,3
#.??.?????.???. 1,1,1,3,1
.??.??????? 1,5
..??.??##?####??#? 1,12
##???#?#?????##??? 3,4,1,3,1
?#????###? 4,4
?.?.?????.? 1,1,2
?.?????.????###?? 4,7
?.?????#..? 1,1,1
??.???..##? 1,1,3
#??????????##??? 1,2,1,3,1
.????#?##??#. 8,1
??..????####? 1,4
??#?#?#.??#???????.? 6,2,3
????#???##??????. 8,2
?#??#?????.?#.#?# 1,4,2,3
?????#?#???..?????. 1,1,6,1,1
???#????.?##????.?#? 4,1,3,2,2
?????####?#?.??. 10,1
?????..????????##?? 1,11
##??#??#?.?#..? 3,1,3,2,1
#?##?.?????#?????# 4,1,7
.??????.??#?#.??# 6,3,1,3
????#????#???? 1,6,2
??###?????#.????.??? 10,1,2,2
?.?##???#.?#?.# 1,4,1,2,1
???.??#??#?#??.#.??? 1,1,6,1,1,1
?.?.?..###??##??. 1,9
#.#?#??#??##??#?? 1,1,8,3
??????????###?#?? 2,3,3,1,1
?#???#??##????.??? 6,3,2,1
??.?#???#??? 1,1,3
???#??.??.. 1,1,2
.?#?#????#?#??.#?#? 6,3,3
?##??#??#?#??.???? 13,3
#.#??????. 1,1,3
???#??????##?????? 1,3,6
?.????????? 1,2
#?#???????#?#????. 1,1,6,1,1,1
.#?#?.???#.# 4,4,1
?#?#...???.????##?? 1,1,3,1,2,1
.#??????#?#.? 1,1,5
...????.#?? 1,2
.#????##??#.??.?? 1,6,1,1,1
.##???#?????. 6,2
??#??.??????#?####. 1,1,1,1,9
#?????#?#?#??#??#? 2,1,11
?????????#??#? 1,7
??????#??.???#?? 9,5
??????#?.?..#.?..? 1,6,1,1,1,1
?#???#?.#??#?#? 2,2,6
????###???.?##???? 2,5,1,2,1
????#????? 1,7
?.?##?#???.???. 1,2,1,2,3
?##?#.????#?#??#??? 3,1,2,2,5
??##??#??.?? 6,1
#.???????##?. 1,1,1,3
.?###.???# 3,1,1
.??##???#?##? 1,10
?.???.???.. 1,2
.?#.#??##??? 2,5,1
????????????????? 3,2,2,1,1
.#?.???.?????#??#??? 2,1,11
????#?????.??????. 7,1,1
??..??##?#???#?? 1,9
?????#?#????????? 1,12,1
####?###????? 8,2
?#??#??.?#?? 6,2,1
????.##???????#??? 1,3,1,4,1
??.????.?.??. 3,2
#??#???.?#??##?##? 2,2,1,5,3
???.????????? 1,3,3
.???##?#?????? 2,9
?##?#?#?#????.? 5,1,1,1,1
??????#?#??????## 1,1,3,1,3
.??????#??????#.? 1,1,1,6,1
???#.???.???.?#??# 1,1,1,1,3,1
????.???##??.??.?#.. 1,1,7,1,1
??#.???#??? 1,3
??????.???? 2,1
???????.?#??#??###. 1,1,10
?#?#?##?##.???? 2,7,1,1
???..?#.??.#. 3,2,1,1
.?...???????????#??? 2,11
???.?.?????...??? 1,5
???#???#??##???#??#? 2,6,3,1
??#?.????.?.??#??##? 3,1,2,1,7
?#?.?????#??? 3,1,4
.#?##?.???????? 5,6
.?.#???????. 1,5,1
?..?#???#???????#? 6,4
#????.?##???. 4,4
????#.#??????? 1,2,1,3
????.?#???##???????? 4,12,1
?#..????#???# 1,7
????#??#??????..#?? 1,3,2,3,1,1
??.?##??#??... 2,3,3
???.???#??#???..?? 1,8
???????#?###?#?? 6,7
?????????#?#????? 1,1,10
?#.??.??##???.?#.? 1,4,2
#?????##???#?.#??# 1,10,1,1
?????????#???#??##. 1,1,1,1,7,2
??.?#?..?? 2,1
???#..?.??####?##??? 1,11
?.?#????????? 1,1,2,4
???#???.#??? 6,3
..?????#.? 1,1,1
?.??#?????? 1,8
?#????????????? 4,1,4,1
??.??##????????.???# 8,1,1
#??.??????? 3,1,1
????.????????????. 2,3,1,1,1
??????#??#?. 1,4
.?#.???.????? 2,2,4
..???#?#??# 5,1
..?????.?.?#?#?. 4,4
.#?.???????.? 2,5
#??????#??#?#?.#?. 1,3,1,2,2,1
???..???##?????#?? 1,10
?????..??????#?????# 1,1,1,2,3,3
??#??##??? 7,1
????.#?????#?#? 1,2,5
??..??.?#? 1,3
?????.?.???#?? 2,1,1,1
?.#?#?#.???#?. 3,1,2
#??.????#.?#? 1,3,1,1
.?#?#???#?? 3,2
.??##????#??#?? 12,1
#??#??????? 6,3
#?##.??#??#? 4,3,1
#?????.???.????#??? 2,2,5
???????.?.?..???.#? 3,1,1,1,1,2
#?#?#.###???#?.??? 1,3,3,1,2,2
.???##.??#?. 4,2
??????????? 1,5
??#.???????#?#????# 1,1,11
???#?.??#?.???#?? 1,3,1,2,5
?????#??????.???#?? 3,3
??#?###????##..?? 13,2
..?##???????#??..? 4,1,6,1
.??????????#?. 1,3,1,1
???????#?. 2,3
???#.#..???? 2,1,2
?.????.????#?? 1,1,1,5
?#.????#??????? 1,7
????#??????.?.?.# 1,6,1,1,1
??.#.??#..?? 1,1,1,1
??#????????.? 4,3
????.?###??? 2,5
#####??.#?.? 6,2
?#..#??#???????? 1,1,6,1
???#?#???##?.?#?.? 2,4,4,3
??##??##?????#?? 9,4
#????.#.#..?? 3,1,1,1"""


@mark.parametrize(("input_string", "expected_output"), [(EXAMPLE_INPUT, 21), (PUZZLE_INPUT, 7843)])
def test_part1(input_string: str, expected_output: int) -> None:
    assert part1(input_string) == expected_output


@mark.parametrize(("input_string", "expected_output"), [(EXAMPLE_INPUT, 525152), (PUZZLE_INPUT, 10153896718999)])
def test_part2(input_string: str, expected_output: int) -> None:
    assert part2(input_string) == expected_output
